---
title: MySQL数据库架构-imooc
date: 2019-11-14 20:32:46
categories: 数据库
tags: 
- MySQL
description: 二、MySQL数据库架构（实例和故事、MySQL性能、基准测试、结构优化、架构设计、索引优化、SQL查询优化、分库分表、监控）
---

    
## 二、MySQL数据库架构

### Ch1-实例和故事
- 在双11大促中的数据库服务器
    - 和Web服务器的不同：一个可以做水平扩展（集群），另一个要保证完整性和一致性，不能做集群
    - 数据库架构—1主15从：35万QPS、10万TPS（每秒处理的事务数目）
    - 并发量vs同时连接数：连接不一定处理请求，大多数处于sleep状态
    - idle：CPU空闲百分比
- 在大促中是什么影响了数据库性能
    - 超高的QPS和TPS：慢查询、低效率的SQL
    - 大量的并发和超高的CPU使用率
        - 大并发会导致数据库连接数被占满，没连上会出现500错误
        - 超高的CPU使用率会使资源耗尽而宕机
    - 磁盘IO性能突然下降：使用更快的磁盘设备、调整计划任务，如备份计划
    - 网卡IO被占满：减少从服务器数量、进行分级缓存、避免使用select *、分离业务网络和服务器网络
- 还有什么会影响数据库性能
    - 大表带来的问题（大表：行数超过千万行、数据超过10G）
        - 慢查询：很难在一定的时间内过滤出想要的数据
        - 建立索引需要很长的时间
        - 修改表结构需要长时间锁表
    - 如何处理大表
        - 分库分表，难点：分表主键的选择、分表后夸分区数据的查询和统计
        - 归档历史数据，难点：归档时间点的选择、如何进行归档操作
    - 事务是什么
        - 事务：ACID，是数据库系统区别于文件系统的重要特性之一
        - 原子性：转账操作的扣钱和加钱应该一起完成
        - 一致性：转账前后的总金额应该一致
        - 隔离性：扣钱时，如果要汇总账户金额，应汇总扣钱之前的余额
            - 四种隔离级别：未提交读（脏读）、已提交读、可重复读（InnoDB默认，即使另一个commit了也看不到操作，多次读SQL的结果是一样的） 、可串行化（读取的每一行数据都加锁）
        - 持久性：修改后永久保存到数据库
    - 大事务带来的问题（大事务：运行时间长、操作数据多，如余额宝）
        - 锁定太多数据，造成大量的阻塞和锁超时
        - 回滚时所需的时间比较长
        - 执行时间长，容易造成主从延迟
    - 如何处理大事务
        - 避免一次处理太多的数据（如一次处理1000个用户）
        - 移除不必要在事务中的SELECT操作

### Ch2-什么影响了MySQL性能

### Ch3-MySQL基准测试

### Ch4-MySQL数据库结构优化

### Ch5-MySQL高可用架构设计

### Ch6-数据库索引优化

### Ch7-SQL查询优化

### Ch8-数据库的分库分表

### Ch9-数据库监控