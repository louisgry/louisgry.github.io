---
title: 《点餐系统》买家端模块开发：类目、商品
date: 2019-11-04 18:57:50
categories: 项目
tags: 
- 点餐系统
description: 项目设计、项目起步、买家端类目、买家端商品
---
<!-- more -->
https://github.com/louisgry/wechat-ordering-system

# Ch1-课程介绍
- 首页
    - 以Spring Boot为主线的技术栈，采用前后端分离架构
    - 企业级开发流程：项目设计、环境搭建、功能开发、项目优化、部署上线（单元测试贯穿始终）
    ![项目技术栈](/images/prj/sell/1.jpg)

- 1-1：课程介绍
    - 项目演示：WebSocket消息推送、微信模板消息
    - 前后端分离（前端：Vue -> WebApp <==RESTful==> 后端：Spring boot -> Bootstrap+Freemarker+JQuery）
    - 技术
        - 数据库：Spring Boot+JPA、Spring Boot+MyBatis
        - 缓存：Spring Boot+Redis（分布式Session、分布式锁）
        - 消息推送：WebSocket
        - 微信：授权登陆、模板消息、微信支付和退款
    - 实现：dao+service+controller
    - 软件版本：`springboot1.5.2`、centos7.3、IDEA2017.1.2、JDK1.8.0_111、maven3.3.9、mysql5.7.17、nginx1.11.7、Redis3.2.8

# Ch2-项目设计
- 2-1：项目设计
    - 角色划分
        - 买家（手机端）
        - 卖家（PC端）
    - 功能模块划分
        - 商品（商品列表）
        - 订单（创建、查询、取消）
        - 类目（订单管理、商品管理、类目管理）
    - 部署架构
        - 买家、卖家请求Nginx服务器，tomcat服务器，redis+mysql
        ![项目部署](/images/prj/sell/2.jpg)
        
- 2-2：架构和基础框架
    - 架构演进
        - 单体应用 -> 垂直应用 -> 分布式服务 -> 流计算 [《SSM实现大众点评》](https://coding.imooc.com/class/105.html)
    - 微服务技术
        - 阿里系：Dubbo服务化治理、zookeeper服务注册中心、spring mvc或spring boot基础框架
        - spring cloud栈：spring cloud、netflix eureka、spring boot
- 2-3：数据库设计
    - sql：https://github.com/louisgry/wechat-ordering-system/blob/master/sell.sql
    - 类目表：product_category
    - 商品表：product_info
    - 订单详情表：order_detail
    - 订单主表：order_master
    - 卖家信息表：seller_info

# Ch3-项目起步
- 3-1：开发环境搭建
    - 创建Spring Boot项目：1.选择Spring Initializr 2. https改为http
    - 修改pom.xml：mysql和lombok、springboot版本改为1.5.3
    ```
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.17</version>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    ```
- 3-2：日志的使用
    - 什么是日志框架
        - 日志：能够描述系统运行状态的所有时间都可以算作日志
        - 日志框架：是一套能实现日志输出的工具包
        - 日志框架能力：定制输出目标、输出格式、携带上下文信息
    - 日志框架的选择
        - JUL、JCL、Log4j、Log4j2、Logback、SLF4j
    - Logback的使用与配置
        - 使用占位符：`logger.info("name: {}, password: {}", name, password);`
        - 配置：1.application.yml，2.logback-spring.xml
- 3-3：源码下载及使用
    - 切换版本：`git checkout -b 5-1 5-1`

# Ch4-买家端类目
- MVC：从数据库开始
    - DAO层设计与开发
    - Service层设计与开发
    - Controller层设计与开发
- resources
    - 配置application.yml：https://github.com/louisgry/wechat-ordering-system/blob/master/src/main/resources/application.yml
    - `spring.jpa.database-platform: org.hibernate.dialect.MySQL5Dialect`
        - 解决“Caused by: org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be null when 'hibernate.dialect' not set”
- dataobject
    - 新建ProductCategory类目实体类
        - 三个属性：`categoryId、categoryName、categoryType`
    - 快捷键`alt+insert`：Getter and Setter
    - `@DynamicUpdate`：动态更新时间，update操作（4-2）
    - lombok：不需要重写Getter and Setter
        - 1.添加依赖
        - 2.安装plugin: lombok
        - 3.添加`@Data`
        ```
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
        ```
- repository
    - 新建ProductCategoryRepository接口`extends JpaRepository`
        - 声明`findByCategoryTypeIn`方法：根据类目type列表查询类目
    - test
        - 快捷键`ctrl+shift+T`：Go to Test
        -`NPE空指针异常`：没有加RunnerWith注解
    - test下编写findOneTest方法
        - 添加注解：`@RunWith(SpringRunner.class)、@SpringBootTest`
        - `@Autowired` ProductCategoryRepository
        - `findOneTest`：`productCategoryRepository.findOne(1)`
    - test下编写saveTest方法
        - 添加`@Transactional`注解就不会插入到数据库中，仅测试用（4-2，有别于service）
        - `import javax.transaction.Transactional`
        - `productCategoryRepository.save(new ProductCategory("男生最爱", 10))`
    - test下编写findByCategoryTypeInTest方法
        - `productCategoryRepository.findByCategoryTypeIn(Arrays.asList(2,3,4))`
- service
    - 新建CategoryService接口
        - 声明四个方法：`findOne()、 findAll()、 findByCategoryTypeIn()、 save()`
    - sevice下的Impl新建CategoryServiceImpl
        - 快捷键`alt+Enter`：Go to Implement
        - Impl第一件事：`@Service`
    - test下做单元测试
        - 给`SellApplicationTests`类增加`@RunWith(SpringRunner.class)`
        - 并设置类和contextLoads方法为public
        - 在测试类`@Component`、`extends SellApplicationTests`

# Ch5-买家端商品
- dataobject
    - 新建ProductInfo商品实体类
- enums
    - 新建ProductStatusEnum枚举类：UP(0) 在架、DOWN(1) 下架
    - `@Getter` + 字段 + 构造函数
    - 使用：`ProductStatusEnum.UP.getCode()`
- repository
    - 新建ProductInfoRepository接口
        - 声明`findByProductStatus`方法：根据商品状态查询商品信息
    - test下做单元测试
- service
    - 新建ProductService接口
        - 声明四个方法：`findOne()、findUpAll()、findAll()、 save()`
        - `import org.springframework.data.domain.Pageable`
    - service下的Impl新建ProductServiceImpl类
    - test下做单元测试

- api文档
    - 商品列表
    ```
    GET /sell/buyer/product/list
    参数：无
    返回：
    {
        "code" : 0,
        "msg": "成功",
        "data": [{ "name": "热榜", "type": 1, "foods": [{"id": "123456", "name": "皮蛋粥", "price": 3.2, "description": "很好吃", "icon": "image.imooc.com/1.jpg",}]}]
    }
    ```
- controller
    - 新建BuyerProductController类
        - 修改application.yml：`server.context-path: /sell`
        - `@RequestMapping("/buyer/product")` `@GetMapping("/list")`
        - `public ResultVO list()`：1.查询所有在架商品 2.查询类目 3.数据拼装
        - 复制属性：`BeanUtils.copyProperties(productInfo, productInfoVO);`（把前面的复制到后面）
        - Run `SellApplication` 开启服务，访问 `http://127.0.0.1:8080/sell/buyer/product/list`
- vo（View Object）
    - 新建ResultVO、ProductVO、ProductInfoVO类
    - `@JsonProperty`
    - Chrome插件：`Json View`
- utils
    - 新建ResultVOUtil类
- 前后端联调
    - 安装virtualbox还原centos.ova镜像
        - 网络设置网卡1：网络地址转换(NAT)、准虚拟化网络、全部允许
        - 网络设置网卡2：仅主机（Host-Only）网络、准虚拟化网络、全部允许
    - 虚拟机修改Nginx配置
        - `vim /usr/local/nginx/conf/nginx.conf`
        - 把127.0.0.1:8080修改为`10.24.80.214:8080`
        - `nginx -s reload`
    - chrome打开前端：`192.168.56.101`
        - 先进入不会跳转页：`192.168.56.101/#/order`
        - F12下console输入：`document.cookie='openid=abc'`
        - 然后进入首页：`192.168.56.101`
