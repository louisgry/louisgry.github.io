---
title: 数据库：MySQL-Mysql8.0详解与实战
date: 2019-11-18 20:47:07
categories: 数据库
tags: 
- Ebbinghaus
- Redis
description: 数据库选型（SQL or NoSQL、选型原则）<br>数据库设计（业务分析、逻辑设计、物理设计）<br>数据库访问<br>SQL开发<br>SQL优化<br>事务和高并发
---

# Ch1-开篇引导
- 课程目标
    - 用SQL解决企业中存在的真实业务痛点问题
- 课程大纲
    - 数据库选型
        - NoSQL or SQL
        - 各种数据存储系统的适用场景
        - 构建MySQL开发环境
    - 数据库设计
        - 逻辑设计：范式化 vs 反范式化
        - 物理设计
        - 业务分析
    - 数据库访问
        - MySQL驱动
        - 访问故障处理
    - SQL开发
        - 基本功：DCL&DDL&DML
        - 必备技能：常用函数
        - 高阶：CTE、窗口函数
    - SQL优化
        - 分析执行计划
        - 索引和SQL改写
        - 排查性能瓶颈
    - 事务和高并发
        - 什么是事务
        - 高并发的隐患
        - 事务隔离级别
        - 阻塞和死锁

# Ch2-数据库选型
- 问题
    - 面对全新的业务场景，如何开展数据库选型？
- SQL vs NoSQL
    - 关系型数据库
        - 数据结构化存储在二维表中
        - 支持事务的ACID（原子性、一致性、隔离性、持久性）
        - 支持使用SQL进行数据操作
    - 关系型数据库适用场景
        - 数据之间存在着一定的关系，需要关联查询数据的场景
        - 需要事务支持的业务场景
        - 需要使用SQL语言灵活操作数据的场景
    - 非关系型数据库
        - 存储结构灵活，没有固定的结构
        - 对事务的支持弱，但对数据的并发处理性能高
        - 大多不使用SQL处理数据
    - 非关系型数据库适用场景
        - 数据结构不固定的场景
        - 对事务要求不高，但读写并发比较大的场景
        - 对数据处理操作比较简单的场景
- 关系型数据库选型原则
    - 数据库使用是否广泛
    - 数据库的可扩展性
    - 数据库的安全性和稳定性
    - 数据库所支持的系统
    - 数据库的使用成本

# Ch3-数据库设计
- 业务分析
    - 一般步骤：业务分析 -> 逻辑设计 -> 数据类型 -> 对象命名 -> 建立库表
    - 慕课网前端数据库结构设计
    - 总结所需的属性（课程的属性、课程列表、讲师、评论、笔记、用户、评价）
- 逻辑设计
    - 逻辑设计之宽表模式：设计到一张大表中，有很多列
        - 宽表模式问题：数据冗余、数据更新异常（修改一行的值，同时修改了多行），插入异常（缺失主键而无法插入表），删除异常（删除时必须删除另一数据）
        - 宽表模式适用场景：配合列存储的数据报表应用
    - 逻辑设计之数据库设计范式
        - 第一范式：表中的所有字段都是不可再分的
            - 联系方式字段，有手机、邮箱、微信
        - 第二范式：表中必须存在主键，并且非主键依赖于全部的主键
            - 笔记表中，用户积分不依赖于符合主键（用户+章节+标题）
        - 第三范式：表中的非主键列之间不能相互依赖
            - 课程表中，讲师职位依赖于讲师名
    - 面向对象设计
        - 课程对象逻辑建模：课程表、课程方向表、课程分类表、课程难度表
        - 课程列表对象逻辑建模：章节表、小节表、课程同章节关联表、章节同小节关联表（删除关联表，反范式化设计）
        - 用户对象逻辑建模：用户表、讲师表合并（讲师标识字段）
        - 问答评论对象逻辑建模：问答评论表
        - 笔记对象逻辑建模：笔记表
        - 课程评价对象逻辑建模：评价表、用户选课表
    - 范式化设计存在的问题
        - 如何获取出一门课程包括的所有章节和小节信息（需要5张表：课程表、章节表、小节表、课程同章节关联表、章节同小节关联表）
    - 反范式化设计：减少查询时所需要关联表的数量，以提高查询性能
        - 课程表和章节表是一对多的关系：所以可以合并{课程主标题、课程章节名、章节说明、章节编号}，虽然违反第二范式，但是可以少关联表
        - 章节表和小节表也是一对多的关系：合并
        - 现在，只需要3章节就可以查询信息：课程表、章节表、小节表
- 物理设计
    - MySQL常见的存储引擎
        - MyISAM：不支持事务，MySQL5.6之前的默认引擎
        - InnoDB：最常用的事务型存储引擎
        - CSV：不支持事务，以CSV格式存储
        - Archive：不支持事务，只允许查询和新增数据而不允许修改
        - Memory：不支持事务，存储在内存中，容易丢失数据
    - InnoDB存储引擎的特点
        - 支持ACID
        - 数据按主键聚集存储
        - 支持行级锁及MVCC（多版本并发控制）
        - 支持BTree和自适应Hash索引
        - 支持全文和空间索引
    - 根据InnoDB特性优化表逻辑结构
        - 课程表：新增课程ID（自增ID）
        - 章节表：新增章节ID
        - 小节表：新增小节ID
    - 常用的数据类型
        - 整数类型：`tinyint、smallint、mediumint、int、bigint`（-2^7~2^7-1）
        - 浮点类型：`float、double、decimal（精确类型）`
        - 时间类型：`date、time、year、datetime、timestamp（时区）`
        - 字符串类型：`char、varchar、tinytext、text、mediumtext、longtext、enum`
    - 为列选择合适的数据类型
        - 优先选择符合存储数据需求的最小数据类型
            - 举例：字符串转整数存储，如IP地址：`inet_aton('255.255.255.255') = 4294967295`
        - 谨慎使用text、enum字符串类型
            - text：内存临时表不支持大数据类型
            - enum：转为整数存储的
        - 同财务相关的数值型数据，必须使用decimal类型
    - 回归项目的物理设计
        - 课程表字段的数据类型选择：课程ID选int unsigned，时长time
        - 章节表字段的数据类型选择：章节ID选int unsigned，章节编号tinyint(2) unsigned
        - 小节表字段的数据类型选择：小节ID选int unsigned，视频格式enum('avi','mp4','mpeg')
        - 课程分类表字段的数据类型选择：课程分类ID选smallint unsigned
        - 用户表字段的数据类型选择：密码选char(32)、性别选char(2)，说明varchar(100)
        - 问答评论表字段的数据类型选择：评论内容text
    - 数据库对象命名规则
        - 名称必须使用小写字母，可选用下划线分割
        - 禁止使用保留关键字
        - 命名应见名识义，不超过32个字符
        - 临时表必须以tmp为前缀，并以日期为后缀
        - 用于备份的库，表必须以bak为前缀，并以日期为后缀
        - 所有存储相同数据的列名和列类型必须一致
    - 项目的库、表和列命名
